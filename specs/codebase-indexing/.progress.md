# Progress: codebase-indexing

## Original Goal
Create a feature to scan a repository and create basic "specs" - essentially indexing the current codebase to understand its structure, patterns, and components. The goal is to have spec files for old/existing codebases that don't have them, enabling new features to leverage existing specs during research.

## Status
- Phase: tasks
- Started: 2026-02-04
- Research: implicitly approved
- Requirements: implicitly approved
- Design: implicitly approved
- Total tasks: 27

## Interview Format
- Version: 1.0

## Intent Classification
- Type: GREENFIELD
- Confidence: high (3 keywords matched)
- Min questions: 5
- Max questions: 10
- Keywords matched: create, feature, indexing

## Interview Responses

### Goal Interview (from start.md)
- Problem: All of the above - onboarding, pre-spec context, documentation, and code discovery
- Constraints: Must integrate with Ralph specs workflow - output should feed into research/requirements phases
- Success criteria: When research is done, it should be easily retrievable for future specs
- Output format: Not sure yet - needs research to determine best approach
- Additional context: The indexing is just the concept. The real goal is having spec files for old codebases that don't have them, so new features can search existing specs during the research phase

### Requirements Interview (from requirements.md)
- Primary users: End users via command line (developers using CLI to run indexing)
- Priority tradeoffs: Prioritize feature completeness
- Success criteria: Manage to gather all codebase functionality from existing and external resources (like online docs)
- Additional requirements context: None - ready to proceed

### Requirements Review (from requirements.md)
- User stories approval: Added US-9 for interview-driven indexing after feedback
- Acceptance criteria approval: Updated to remove CLI flags, make external resources interview-driven
- Priorities approval: Yes, appropriate
- Requirements feedback: Approved, ready to proceed

### Design Interview (from design.md)
- Architecture style: Extend existing architecture - add /ralph-specum:index command following existing plugin patterns
- Technology constraints: No constraints - use whatever tools and patterns work best
- Integration approach: Use existing APIs and interfaces - integrate with spec scanner, research analyst, existing templates
- Additional design context: None - ready to proceed

### Design Review (from design.md)
- Architecture approval: Yes, looks good
- Technical decisions approval: Yes, approved
- Component structure approval: Yes, clear
- Design feedback: Approved, ready to proceed

### Tasks Interview (from tasks.md)
- Testing depth: Standard - unit + integration
- Deployment approach: Standard CI/CD pipeline
- Execution priority: Balanced - reasonable quality with speed
- Additional execution context: None - ready to proceed

### Tasks Review (from tasks.md)
- Task coverage: Yes, comprehensive
- Task phases: Yes, good structure
- Verification steps: Yes, clear
- Tasks feedback: Approved, ready to proceed

## Completed Tasks
- [x] 1.1 Create component-spec template - fa4931a
- [x] 1.2 Create external-spec template - c8e834e

## Current Task
Awaiting next task

## Next
Task 1.3: Create index-summary template

## Learnings
- Spec scanner in start.md (lines 573-665) uses simple keyword matching against Original Goal text
- Related specs discovery in research-analyst.md (lines 78-103) classifies relevance as High/Medium/Low
- Lightweight approach preferred - fits existing workflow, no external dependencies
- Existing tools (Glob, Grep, Read, Task) sufficient for codebase analysis
- Current spec format: .progress.md (goal/status), research.md, requirements.md, design.md, tasks.md
- Plugin has no build step - pure markdown, changes on Claude restart
- Reference implementation: BIM360/rfis-service/ai/generate-docs.js
  - analyzeComponents() walks dirs, categorizes by path/name patterns
  - extractFunctions(), extractExports(), extractDependencies() for code analysis
  - documentBatch() generates docs without prompts
  - Template-based markdown output
- Store generated specs in specs/.index/ (separate from feature specs)
- Add hint in /ralph-specum:start when no index exists to surface the feature
- Requirements: Scope expanded beyond local code to include external docs (--docs-url flag)
- Requirements: Two spec types needed - component specs (code) and external doc specs (URLs)
- Requirements: Key unresolved question - should indexed specs be gitignored or committed?
- Requirements: Need default excludes that work across JS/TS, Python, Go ecosystems
- Requirements Update (2026-02-05): Added US-9 for interview-driven indexing experience
  - Pre-scan interview pattern mirrors start.md/requirements.md interview flows
  - Uses AskUserQuestion for 3 pre-scan questions: external resources, focus areas, sparse areas
  - Post-scan review shows findings and asks for validation before completing
  - Added FR-17 through FR-24 for interview flow requirements
  - `--quick` flag bypasses interview for batch/CI use cases
- Requirements Update (2026-02-05): Changed external resource discovery from CLI flags to interview-driven
  - REMOVED: `--docs-url` flag from US-2 and FR-5
  - ADDED: Flexible resource types in US-2 - URLs, MCP servers, installed skills
  - UPDATED: US-9 clarifies external resources discovered conversationally during pre-scan interview
  - UPDATED: FR-5 and FR-18 now reflect interview-based discovery instead of CLI flags
  - RESOLVED: "CLI flags vs manifest?" unresolved question - neither, it's interview-driven
  - NEW QUESTION: How to document MCP server capabilities (list tools vs summarize?)
- Design (2026-02-05): Architecture decisions made
  - Storage: `specs/.index/` with components/ and external/ subdirs
  - 3 templates needed: component-spec.md, external-spec.md, index-summary.md
  - Component detection via Glob patterns + regex extraction (cross-language)
  - External resources: WebFetch for URLs, ListMcpResourcesTool for MCP, plugin introspection for skills
  - start.md modifications: add hint (line ~571), enhance spec scanner (lines 573-665)
  - MCP documentation: list tools with brief descriptions (comprehensive but scannable)
  - Recommend committing indexed specs (team value, not truly regeneratable with external resources)
  - Default excludes: node_modules, vendor, dist, build, test files, __pycache__
- Task Planning (2026-02-05): 27 tasks across 5 phases
  - Phase 1 (POC): 18 tasks - templates first, then command sections, then start.md mods
  - Phase 2 (Refactor): 5 tasks - error handling, edge cases, schema update
  - Phase 3 (Testing): 4 tasks - test fixtures and documentation (no automated tests - pure markdown plugin)
  - Phase 4 (Quality): 4 tasks - verification and PR creation
  - Phase 5 (PR Lifecycle): 4 tasks - CI monitoring and review resolution
  - Key insight: Plugin is pure markdown, no build/test commands - verification uses file existence and grep
  - Quality checkpoints inserted every 2-3 tasks throughout Phase 1
  - Dependencies: templates -> command -> start.md modifications
