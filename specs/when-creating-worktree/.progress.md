---
spec: when-creating-worktree
phase: execution
task: 0/7
updated: 2026-01-29
---

# Progress: when-creating-worktree

## Original Goal

When creating a worktree, copy temp files like .current-spec and state so /research has the state

## Context

This is a Claude Code plugin (ralph-specum) that manages spec-driven development. When a user creates a git worktree (via /ralph-specum:start), the current spec state files (.current-spec, .ralph-state.json, .progress.md) are not copied to the worktree. This means if the user starts research in the main directory and then creates a worktree, running /research in the worktree won't know which spec they were working on.

## Learnings

- Worktree creation happens in start.md around lines 115-146
- State files are gitignored (intentionally) so they don't sync via git
- Three files need copying: .current-spec, .ralph-state.json, .progress.md
- SPEC_NAME may be empty at worktree creation time - need fallback to .current-spec
- Synthesis insight: Simple file copy after git worktree add is sufficient
- Pattern found: Use conditional checks before copy to handle missing files gracefully

## Completed Tasks

- [x] 1.1 Add state copy block after git worktree add
- [x] 1.2 Update user guidance to mention state copy
- [x] 1.3 POC Checkpoint - verified code implementation
- [x] 2.1 Handle edge case: SPEC_NAME not yet known
- [x] 2.2 Add error handling for copy failures
- [x] 3.1 Add verification steps to start.md documentation
- [x] 4.1 Version bump plugin

## Current Task

Awaiting next task

## Learnings

- Worktree creation happens in start.md around lines 115-146
- State files are gitignored (intentionally) so they don't sync via git
- Three files need copying: .current-spec, .ralph-state.json, .progress.md
- SPEC_NAME may be empty at worktree creation time - need fallback to .current-spec
- Synthesis insight: Simple file copy after git worktree add is sufficient
- Pattern found: Use conditional checks before copy to handle missing files gracefully
- State copy block inserted after line 127 (git worktree add) - copies .current-spec, .ralph-state.json, .progress.md with non-overwrite semantics
- POC verified: code inspection confirms all three state files are copied with proper conditional checks and non-overwrite semantics
- Added fallback: when SPEC_NAME is empty, read from .current-spec to get the current spec name before copying state files
- Added graceful error handling: all copy commands now use `|| echo "Warning: ..."` or `|| true` to produce warnings without blocking worktree creation

## Blockers

- None currently

## Next

All tasks complete
