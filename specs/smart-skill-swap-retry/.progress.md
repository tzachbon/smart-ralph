# Progress: smart-skill-swap-retry

## Goal
I want that on smart start it will try to look for and swap every skill it deems necessary, and also retry it after research if it missed something.

## Goal Type
- Type: add (enhance existing feature)

## Completed Tasks
- [x] 1.1 Add discoveredSkills to state initialization in start.md (normal mode)
- [x] 1.2 Add discoveredSkills to state initialization in quick-mode.md
- [x] 1.3 Add Skill Discovery Pass 1 to start.md (normal mode, Step 2.5)
- [x] 1.5 Add Skill Discovery Pass 2 to start.md (normal mode, post-research)
- [x] 1.6 Add Skill Discovery Pass 1 to quick-mode.md (Step 8.5)

## Current Task
Awaiting next task

## Learnings
- All 6 ralph-specum skills have `description` in YAML frontmatter -- this is the matching surface
- Skills with `user-invocable: false` (interview-framework, reality-verification, delegation-principle, communication-style) should still be auto-discoverable
- Two clear insertion points: after Step 2 (input parsing) and after research.md creation (before requirements)
- The Skill tool (`Skill({ skill: "ralph-specum:<name>" })`) is the correct invocation mechanism
- Keyword matching is sufficient for ~6 skills; semantic matching would be overengineered
- Both quick mode and normal mode should auto-invoke without prompts (skills are additive context)
- `discoveredSkills` array in .ralph-state.json prevents duplicate invocations across passes
- Skill descriptions contain many generic words ("should", "used", "when", "asks") that need stopword filtering to avoid false positives
- Threshold of 2 keyword overlaps balances precision vs recall for 6 skills
- No separate reference file needed -- only 2 insertion points with minor context differences (goal-only vs goal+summary)
- Post-research pass should use Executive Summary section only, not full research.md (too noisy)
- Resume flow should NOT re-run discovery -- skills were loaded in original session context
- Coordinator performs discovery inline (reading frontmatter + matching) -- this is coordination work, not implementation requiring subagent delegation
- start.md Step 2.5 is normal mode only -- quick mode jumps from Step 2 to Step 5 (quick-mode.md), so it never hits Step 2.5. Quick mode gets Pass 1 at quick-mode.md step 8.5 instead
- Tokenization must treat hyphens as word separators (skill descriptions use them: "brainstorming-style"), strip parentheses/commas/punctuation, and compare case-insensitively
- Task planning: 4 insertion points total (2 in start.md for normal mode, 2 in quick-mode.md for quick mode) -- each self-contained inline
- Task planning: state init happens in 2 places (start.md step 7 for normal, quick-mode.md step 5 for quick) -- both need discoveredSkills: []
- Task planning: no build/lint/typecheck commands exist for this plugin -- quality gates are structural grep checks on markdown content
- Task planning: version bump is 4.1.2 -> 4.2.0 (minor, new feature) in both plugin.json and marketplace.json
- Task planning: start.md normal mode New Flow step numbering is 1-12; insert post-research pass after step 11 (Team Research) before step 12 (STOP)
- Pass 2 inserted as step 12, STOP renumbered to step 13. New Flow is now steps 1-13
- quick-mode.md uses compact code block for step listing + separate ## sections for detailed instructions. Pass 1 added as both step 8.5 in code block and ## Step 8.5 section with full instructions

### Verification: 1.4 [VERIFY] Quality checkpoint: grep for consistent terminology
- Status: PASS
- discoveredSkills count in start.md: 4 (threshold >= 2) -- PASS
- matchedAt count in start.md: 2 (threshold >= 1) -- PASS
- invoked count in start.md: 3 (present in both success and failure paths) -- PASS
- Terminology cross-check with design.md: all field names (discoveredSkills, matchedAt, invoked), values ("start", "post-research", true/false), and object structure ({ name, matchedAt, invoked }) match exactly
- No fixes needed
