# Progress: opencode-codex-support

## Original Goal

Introduce cross-tool support for OpenCode and Codex CLI alongside Claude Code in the Smart Ralph plugin.

Currently Smart Ralph is tightly coupled to Claude Code's plugin system (plugin.json manifest, markdown commands with YAML frontmatter, Task tool for subagent delegation, TeamCreate/SendMessage for team research, Stop/PreToolUse hooks for execution loop). The goal is to make the spec-driven workflow (research → requirements → design → tasks → execute) work natively across all three tools.

### What "full support" means:

1. **Portable Spec Format** — The spec artifacts (research.md, requirements.md, design.md, tasks.md, .progress.md, .ralph-state.json) should remain tool-agnostic. They already are mostly markdown/JSON — ensure no Claude Code-specific assumptions leak into templates or schemas.

2. **SKILL.md as the universal entry point** — SKILL.md is the one format shared identically across Claude Code, OpenCode, and Codex CLI. Convert the core Ralph workflow commands into SKILL.md files that any tool can discover and invoke (start, research, requirements, design, tasks, implement, status, cancel).

3. **AGENTS.md generation** — As part of the spec output, optionally generate an AGENTS.md file that OpenCode and Codex can read for project-level instructions derived from the spec's design decisions.

4. **Tool-specific adapters for execution** — The execution loop currently relies on Claude Code's Stop hook + Task tool. Create adapter layers:
   - **Claude Code**: Current stop-hook + Task tool delegation (no changes needed)
   - **OpenCode**: JS/TS plugin hooks (tool.execute.after, session.idle) + task subagent invocation
   - **Codex CLI**: No hooks available. Use MCP server approach — Ralph runs as an MCP server that Codex connects to, providing spec-executor as an MCP tool. Alternatively, rely on SKILL.md progressive disclosure to guide Codex through tasks sequentially.

5. **Team research portability** — Claude Code uses TeamCreate/SendMessage for parallel research.
   - **OpenCode**: Use its native subagent system (task tool with subagent type)
   - **Codex CLI**: Use MCP-based orchestration or fall back to sequential research via SKILL.md guidance

6. **Configuration bridge** — Create a unified ralph config that generates tool-specific configs:
   - Claude Code: .claude-plugin/plugin.json + .mcp.json + hooks/
   - OpenCode: opencode.json plugin entry + .opencode/commands/ + .opencode/agents/
   - Codex CLI: ~/.codex/config.toml MCP entry + .agents/skills/ SKILL.md files + AGENTS.md

### Constraints:
- Don't break existing Claude Code plugin functionality
- Spec file format must remain identical across tools (single source of truth)
- Start with SKILL.md portability (highest leverage, works everywhere) before tool-specific adapters
- OpenCode adapter should use its JS/TS plugin system for hooks, not shell scripts
- Codex adapter must work within Codex's limitations (no hooks, no custom commands, no custom agents)

### Success criteria:
- A user can run the Ralph spec workflow in OpenCode using `$ralph:start` or equivalent
- A user can run the Ralph spec workflow in Codex CLI using skill discovery
- Existing Claude Code users see zero regression
- Spec artifacts generated in one tool can be executed in another

## Interview Format
- Version: 1.0

## Intent Classification
- Type: GREENFIELD
- Confidence: high (5 keywords matched)
- Min questions: 5
- Max questions: 10
- Keywords matched: introduce, support, create, implement, build

## Completed Tasks
- [x] 1.1 Audit templates and schemas for Claude Code-specific references
- [x] 1.2 Create start SKILL.md

## Current Task
Awaiting next task

## Learnings
- Spec artifacts (.ralph-state.json, .progress.md, templates, schemas) are already mostly tool-agnostic. Only minor audit needed.
- The 16 commands in commands/ all use Claude Code-specific YAML frontmatter (allowed-tools, argument-hint). These cannot be reused directly in other tools.
- 6 SKILL.md files already exist in the plugin (communication-style, delegation-principle, interview-framework, reality-verification, smart-ralph, spec-workflow). These prove the SKILL.md pattern works.
- The stop-watcher.sh is the most complex Claude Code-specific component (195 lines of bash). OpenCode adapter needs to replicate this in TypeScript.
- Codex CLI has the most limited feature set -- no hooks, no commands, no agents. SKILL.md progressive disclosure is the only viable approach for execution.
- The path-resolver.sh (bash functions) is portable and can be reused across adapters.
- Existing templates in templates/*.md contain no Claude Code-specific references -- they use generic markdown with mustache-style placeholders.
- Schema spec.schema.json is tool-agnostic (standard JSON Schema, no Claude Code references).
- The plan-synthesizer agent is the natural place to add AGENTS.md generation since it already generates all spec artifacts.
- MCP server approach for Codex is deferred to future work -- SKILL.md guidance provides 80% of value with 20% of effort.
- Task 1.1 audit: Templates had zero matches for primary Claude Code tool references (Task tool, AskUserQuestion, TeamCreate, SendMessage, Stop hook, subagent_type, allowed-tools). Only one minor Claude-specific path reference in settings-template.md (.claude/ralph-specum.local.md) was made tool-agnostic. Schema spec.schema.json is fully tool-agnostic.
- Task 1.2: SKILL.md progressive disclosure pattern: Level 1 = Overview (what it does), Level 2 = Steps (numbered how-to with code examples), Level 3 = Advanced Options (flags, edge cases). Existing SKILL.md files in the repo use YAML frontmatter with `name` and `description` fields. The start command has extensive logic (branch management, spec scanner, team research, quick mode) that was distilled into tool-agnostic instructions.

## Next
Task 1.3: Create research SKILL.md
