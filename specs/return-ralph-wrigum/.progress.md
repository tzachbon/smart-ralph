---
spec: return-ralph-wrigum
created: 2026-02-14
---

# Progress: return-ralph-wrigum

## Original Goal
In some PR we added or merged, we removed the Ralph Wrigum. Unfortunately we need to return it back. Let's plan how we do it. Make sure to look online: how the newest Ralph Wrigum is used, how it is required to be installed, how a user needs to be installed, how we should return it to the implement phase, how we revert it safely. We need to do all of that. Your output should be a PR at the end of the day.

## Current Task
Generating spec artifacts (quick mode)

## Learnings
- Ralph Wiggum plugin is at `anthropics/claude-code/plugins/ralph-wiggum/`, installed via `/plugin install ralph-wiggum@claude-plugins-official`
- Known bug: `--max-iterations=N` (equals syntax) silently ignored, must use space syntax `--max-iterations N`
- Known issue: Ralph Wiggum accumulates context (growing tokens per iteration) unlike original Ralph technique
- Hook coexistence is the primary risk: both Ralph Wiggum and our plugin register Stop hooks. Our stop-watcher.sh must be made completely passive (no stdout output) to avoid conflicts.
- The current codebase (v3.1.1) has 39 bats-core tests that assume stop-watcher.sh controls the loop - these need updating
- Ralph Wiggum state lives in `.claude/ralph-loop.local.md` (YAML frontmatter + prompt body), separate from our `.ralph-state.json`
- v3.0.0 added significant improvements over v2.0.0: recovery mode, fix-task generation, global iteration limits, multi-directory support, parallel group detection - ALL must be preserved in coordinator prompt passed to ralph-loop
- The coordinator prompt in implement.md is ~1000+ lines - this entire prompt gets passed as the ralph-loop prompt argument
- cancel.md was simplified in v3.0.0 to just file deletion + spec removal - needs /cancel-ralph added back
- Version should go to 4.0.0 since this is another breaking change (requires external dependency)
