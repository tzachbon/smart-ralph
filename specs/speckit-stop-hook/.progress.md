# Progress: speckit-stop-hook

## Original Goal
Upgrade ralph-speckit's stop-watcher.sh to be a self-contained execution loop controller with JSON output format, matching the pattern established in ralph-specum's stop-watcher.sh (commit a939076). The speckit stop-watcher currently acts as a passive watcher that always exits 0 and just logs to stderr. It needs to become an active loop controller that outputs JSON continuation prompts ({decision: "block", reason: ..., systemMessage: ...}) to enable self-contained task execution without depending on an external ralph-loop plugin.

## Completed Tasks
- [x] 1.1 Rewrite stop-watcher.sh as self-contained loop controller
- [x] 1.2 Update implement.md to remove ralph-loop dependency
- [x] 1.3 Update cancel.md for self-contained cancellation
- [x] 1.4 Update state schema for forward compatibility
- [x] 1.5 Bump version to 1.0.0

## Current Task
Awaiting next task

## Learnings
- Speckit stop-watcher is 56 lines (passive); specum is 195 lines (active controller). Gap is ~140 lines of new logic.
- Speckit uses `.specify/.current-feature` (not `specs/.current-spec`) and `.speckit-state.json` (not `.ralph-state.json`).
- Speckit state schema has `additionalProperties: false` — must change to `true` since recoveryMode/fixTaskMap fields need to be allowed.
- Speckit implement.md writes `.coordinator-prompt.md` and invokes `ralph-loop:ralph-loop` skill — both must be replaced with direct prompt output.
- Speckit cancel.md invokes `ralph-wiggum:cancel-ralph` — must be replaced with direct state file deletion.
- Existing test suite (`tests/stop-hook.bats`) and helpers (`tests/helpers/setup.bash`) test specum only; speckit needs its own test file with adapted paths.
- Specum has a `SessionStart` hook (`load-spec-context.sh`) that speckit lacks — out of scope for this change but noted for future.
- Version bump should be 1.0.0 (major) since removing ralph-loop dependency is a breaking change.
- Speckit hooks.json lacks `matcher: "*"` that specum has — should be added for consistency.
- New stop-watcher.sh is 191 lines. Port was straightforward: replaced path-resolver with fixed .specify/ path, updated all log prefixes and command references.
- End-to-end test confirmed JSON output with all 3 required fields (decision, reason, systemMessage).
- implement.md edit was straightforward: removed 3 sections (dependency check, write-to-file, skill invocation), added "Start Execution" section with design note matching specum pattern.

## Next
Task 1.6: POC Checkpoint
