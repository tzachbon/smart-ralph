# Progress: plan-source-feature

## Goal
Allow users to skip the spec phases and start directly from task execution using their own plan (could be a file or a prompt). The system will automatically generate a full spec without user interaction.

## Status
- [x] Spec created
- [x] Research
- [x] Requirements
- [x] Design
- [x] Tasks (11 total)
- [x] Implementation

## Completed Tasks
- [x] 1.1 Add --quick flag parsing to start.md - e9a7dd8
- [x] 1.2 Create plan-synthesizer agent - 51567b5
- [x] 1.3 Add Quick Mode Flow to start.md - a862b59
- [x] 1.4 POC Checkpoint - c612a97
- [x] 2.1 Add full input detection logic - c93f9c7
- [x] 2.2 Add error handling and validation - 244e36e
- [x] 2.3 Improve name inference in plan-synthesizer - 274cde7
- [x] 3.1 Test goal string input (US-1) - 5a7f7f3
- [x] 3.2 Test explicit name input (US-2) - 198d770
- [x] 3.3 Test file input (US-3) - 1db4b2f
- [x] 4.1 Review and final cleanup - a1ba652

## Current Task
Awaiting next task

## Learnings
- start.md uses markdown-based command definitions with frontmatter for argument hints
- Agent files follow consistent pattern: frontmatter with name/description/model/tools, then instructions with mandatory constraints and output templates
- Quick mode flow requires 10 steps: validate, infer name, create dir, write state, write progress, update current-spec, invoke synthesizer, update state post-gen, display summary, invoke executor
- POC verified via code review: start.md has complete quick mode flow (lines 26-109), plan-synthesizer has all 4 artifact templates
- Input detection uses regex patterns: file paths detected by ./ or / prefix or .md suffix, kebab-case by ^[a-z0-9-]+$ regex
- Name inference: 4-step algorithm (extract key terms, build name, normalize, truncate to 30 chars)

## Test Notes

### 3.1 Goal String Input (US-1) - Code Review Verification

**Test case**: `/ralph-specum:start "Build auth with JWT" --quick`

**AC-1.1 Auto-generated name**: PASS
- start.md lines 61-64: goal string classified when not file path or kebab-case
- start.md lines 94-100: name inferred via first 3 words, kebab-case, max 30 chars

**AC-1.2 All four artifacts generated**: PASS
- plan-synthesizer.md lines 29-35: explicit generation order for all 4 artifacts
- Templates exist: research.md (54-90), requirements.md (93-140), design.md (143-204), tasks.md (207-300)

**AC-1.3 State has source=plan, phase=execution**: PASS
- start.md lines 111-123: initial state has source: "plan"
- start.md lines 144-146: post-generation updates phase to "execution"

**AC-5.2 Artifacts have generated: auto**: PASS
- plan-synthesizer.md lines 24-26: mandatory constraint for generated: auto
- All 4 templates include generated: auto in frontmatter

### 3.2 Explicit Name Input (US-2) - Code Review Verification

**Test case**: `/ralph-specum:start my-feature "Build auth" --quick`

**AC-2.1 Explicit name used without inference**: PASS
- start.md lines 41-47: two-arg detection uses first arg directly as spec name
- First arg validated as kebab-case (^[a-z0-9-]+$)
- Example in docs: `my-feature "Add login" --quick` -> name=my-feature

**AC-2.2 Spec created at ./specs/my-feature/**: PASS
- start.md line 109: creates directory at ./specs/$name/
- When name is explicitly provided, $name = first arg verbatim

**AC-2.3 Provided name used verbatim (not inferred)**: PASS
- start.md lines 92-100: name inference only runs "If no explicit name provided"
- Two-arg case: first arg IS the explicit name, inference skipped entirely

### 3.3 File Input (US-3) - Code Review Verification

**Test case**: `/ralph-specum:start ./test-plan.md --quick`

**AC-3.1 File path detected**: PASS
- start.md lines 44, 50: file path detected if starts with "./" OR "/" OR ends with ".md"
- Two-arg case (line 44): second arg checked for file path pattern
- One-arg case (line 50): arg checked for file path before other classifications
- Examples documented: `./my-plan.md --quick`, `/absolute/path/plan.md --quick`

**AC-3.2 File content read and used as plan**: PASS
- start.md lines 71-78 "File Reading" section:
  - Validate file exists using Read tool
  - If not exists: error "File not found: $filePath"
  - Read file content
  - Strip frontmatter if present
  - Use content as planContent
- Line 142: plan-synthesizer invoked with goal="$goal" (file content)

**AC-3.3 Name inferred from file content**: PASS
- start.md lines 52-53: "Read file content as plan, Infer name from plan content"
- plan-synthesizer.md lines 329-374: name inference algorithm
  - Extract key terms (nouns/verbs), skip stopwords
  - Take up to 4 key terms, join with hyphens
  - Normalize: ASCII-only, max 30 chars, truncate at word boundary
- start.md lines 94-100: fallback inference if not handled by synthesizer

**AC-3.4 File not found error**: PASS
- start.md lines 73-74: "Validate file exists using Read tool, If not exists: error 'File not found: $filePath'"
- start.md lines 169-172 "FILE NOT FOUND" validation:
  - Attempt Read on filePath
  - If file not exists: "File not found: $filePath"
  - Stop execution
- Error message table line 221: "File not found: $filePath"

**Additional verifications**:
- Absolute paths supported: line 28 example `/absolute/path/plan.md --quick`
- .md suffix detection: line 44 "ends with '.md'"
- Two-arg file case: line 47 `my-feature ./plan.md --quick` -> name=my-feature, file=./plan.md
- Empty file error: line 77 "Plan content is empty. Provide a goal or non-empty file."

## PR
https://github.com/tzachbon/smart-ralph/pull/9

## Timeline
- Created: 2026-01-13
