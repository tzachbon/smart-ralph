# Progress: refactor-plugins

## Original Goal
Refactor the plugins in here using the /plugin-dev skills

## Status
- Phase: research
- Started: 2026-01-29

## Interview Format
- Version: 1.0

## Intent Classification
- Type: REFACTOR
- Confidence: high (1 keyword matched)
- Min questions: 3
- Max questions: 5
- Keywords matched: refactor

## Interview Responses

### Goal Interview (from start.md)
- Problem: Improve all plugins according to plugin-dev skills best practices
- Constraints: Use only plugin-dev skills to improve all plugins
- Success criteria: Plugins follow plugin-dev best practices

## Completed Tasks

- [x] Read all plugin-dev skills (plugin-structure, command-development, skill-development, agent-development, hook-development)
- [x] Analyzed ralph-specum plugin structure (plugin.json, commands, agents, skills, hooks)
- [x] Analyzed ralph-speckit plugin structure (plugin.json, commands, agents, skills, hooks)
- [x] Created research.md with comprehensive gap analysis
- [x] 1.1 Add color and examples to ralph-specum agents (8 files)
- [x] 1.2 Add color and examples to ralph-speckit agents (6 files)
- [x] 1.4 Add version to ralph-specum skills (6 files)
- [x] 1.5 Add version and fix descriptions for ralph-speckit skills (4 files)
- [x] 1.6 Add matcher field to hooks (2 files) - 8301b94
- [x] 1.8 Add name field to ralph-speckit modern commands (5 files) - 34bd45b
- [x] 1.9 Migrate legacy commands to commands/ directory (8 files) - 0f617ad
- [x] 1.10 Remove legacy commands directory - b4b6a10
- [x] 1.12 Create validation script - 16fdced
- [x] 1.13 Update CLAUDE.md with best practices
- [x] 2.1 Create failure-recovery skill
- [x] 2.2 Create verification-layers skill
- [x] 2.3 Create coordinator-pattern skill

## Current Task

Awaiting next task

## Learnings

### Verification: 1.14 [VERIFY] Phase A complete validation
- Status: PASS
- Script: `bash scripts/validate-plugins.sh && echo "Phase A PASS"`
- Exit code: 0
- Results:
  - 14/14 agents have color field
  - 14/14 agents have 2+ example blocks
  - 10/10 skills have version field
  - 2/2 hooks.json files have matcher field
  - 0 legacy commands directories found
- No fixes needed

### Verification: 1.11 [VERIFY] Quality checkpoint: commands
- Status: PASS
- Verified: 13/13 commands have `name:` field
- Verified: Legacy directory `plugins/ralph-speckit/.claude/commands/` does NOT exist
- Commands checked: analyze.md, cancel.md, checklist.md, clarify.md, constitution.md, implement.md, plan.md, specify.md, start.md, status.md, switch.md, tasks.md, taskstoissues.md
- No fixes needed

### Verification: 1.7 [VERIFY] Quality checkpoint: skills and hooks
- Status: PASS
- Verified: 10/10 skills have `version:` field
- Verified: 2/2 hooks.json files have `"matcher"` field
- Plugins checked: ralph-specum (6 skills, 1 hooks.json), ralph-speckit (4 skills, 1 hooks.json)
- No fixes needed

### Verification: 1.3 [VERIFY] Quality checkpoint: agent metadata
- Status: PASS
- Verified: 14/14 agents have `color:` field and 2+ `<example>` blocks
- Plugins checked: ralph-specum (8 agents), ralph-speckit (6 agents)
- No fixes needed

- Agents require `color` field (blue, cyan, green, yellow, magenta, red) - this was missing in all agents
- Agent descriptions must include `<example>` blocks with Context/user/assistant/commentary format for proper triggering
- Hook entries require `matcher` field even when applying to all events (use `"*"`)
- Plugin hooks.json format requires outer wrapper: `{"description": "...", "hooks": {...}}`
- Skills require `version` field in frontmatter and third-person description with trigger phrases
- ralph-speckit has legacy command structure in `.claude/commands/` that should be consolidated to `commands/`
- Requirements phase: 5 user stories created covering agents, skills, hooks, commands, and validation
- Requirements phase: 10 functional requirements prioritized P0-P2 (P0=critical, P1=high, P2=nice-to-have)
- Requirements phase: Color grouping by function recommended (analysis=blue/cyan, execution=green, validation=yellow, transformation=magenta)
- Requirements phase: Backward compatibility is critical NFR - zero breaking changes to existing workflows
- Design phase: 36 files total need changes (32 edits, 9 creates, 9 deletes)
- Design phase: Color assignments finalized - blue/cyan for analysis, green for execution, yellow for validation, magenta for transformation
- Design phase: Legacy command migration requires stripping "speckit." prefix for consistency with modern commands
- Design phase: Validation script in bash checks 5 compliance areas (color, examples, version, matcher, legacy dir)
- Design phase: Git provides complete rollback strategy - no destructive external state changes
- Design update: Commands are currently 100-1200 lines - implement.md is 1200+ lines alone
- Design update: Consolidation can extract ~1500 lines from commands/agents into 11 new skills
- Design update: implement.md can be reduced from 1200 to ~150 lines by referencing skills
- Design update: Skill reference pattern uses `<skill-reference>` or inline `**Apply skill**: path` format
- Design update: Phase B adds 11 new skills: failure-recovery, verification-layers, coordinator-pattern, branch-management, intent-classification, spec-scanner, parallel-research, phase-rules, commit-discipline, quality-checkpoints, quality-commands
- Design update: Commands become thin orchestrators (~80-200 lines) that reference skills for heavy-lifting
- Design update: Phase A (metadata) can be deployed independently before Phase B (consolidation)

## Next

Task 2.4 [VERIFY] Quality checkpoint: new skills batch 1

## Blockers

(none)

## Task Planning Notes

- Tasks grouped to reduce count: 8 ralph-specum agents = 1 task, 6 ralph-speckit agents = 1 task
- Total: 32 tasks (14 Phase A, 14 Phase B, 1 Phase 3, 3 Phase 4/5)
- Quality checkpoints every 2-3 tasks as required
- Phase A can be deployed independently (metadata fixes only)
- Phase B has dependency: skills must be created before commands/agents simplified
- Verification commands use bash loops to validate multiple files atomically
