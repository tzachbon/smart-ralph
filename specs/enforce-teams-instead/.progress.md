# Progress: enforce-teams-instead

## Original Goal
Enforce in Claude Code all phases to use teams instead of sub agents if possible.

## Status
- Phase: Phase 2 - Refactoring
- Started: 2026-02-19

## Completed Tasks
- [x] 1.1 Convert research.md to team-based pattern
- [x] 1.2 Add team lifecycle to requirements.md
- [x] 1.3 Add team lifecycle to design.md
- [x] 1.4 Add team lifecycle to tasks.md command
- [x] 1.5 Convert parallel execution in implement.md to team-based
- [x] 1.6 POC Checkpoint - verified all 5 files
- [x] 2.2 Add error handling for team operations
- [x] 2.1 Standardize team lifecycle documentation across all command files
- [x] 2.2 Add error handling for team operations
- [x] 2.3 Update review/feedback loops to work with teams
- [x] 3.1 Validate plugin loads without errors - (verification only, no commit)
- [x] 3.2 Verify markdown structure integrity - all 5 files pass (no fixes needed)

## Current Task
Awaiting next task



## Learnings
- Error handling added to all 5 command files: TeamCreate fallback (direct Task delegation), teammate timeout (check TaskList, log error), TeamDelete failure (non-fatal, orphaned cleanup on next invocation)
- Feedback loop sections in requirements.md, design.md, tasks.md now have explicit mandatory block documenting cleanup-and-recreate pattern for team re-invocations
- implement.md parallel execution converted to 8-step team lifecycle (orphaned check, TeamCreate, TaskCreate per task, Task per executor with team_name, TaskList wait, SendMessage shutdown, TeamDelete, proceed)
- Sequential and VERIFY task delegation paths in implement.md must remain untouched â€” teams only wrap the [P] parallel batch path
- start.md already implements full team lifecycle for research (sections 11a-11h) -- this is the reference pattern
- research.md uses multi-Task parallelism (multiple Task calls in one message) which is functionally parallel but lacks team coordination infrastructure
- requirements.md, design.md, tasks.md each use a single Task(subagent_type: ...) call -- teams add consistency but no parallelism gain
- implement.md has [P] parallel task support via multi-Task calls, and a stop-hook loop that must NOT be replaced
- Sequential execution tasks in implement.md should NOT use teams -- overhead per loop iteration is unacceptable
- Team naming convention `$phase-$spec` prevents collisions when multiple phases run or when debugging orphaned teams
- Orphaned team cleanup is critical because session interruptions can leave teams behind
- Feedback loops (review -> re-invoke agent) need team lifecycle consideration: cleanup-and-recreate is simpler than reusing teams
- design.md allowed-tools changed from restricted list to "*" to support team tools (same pattern as research.md and requirements.md)
- requirements.md allowed-tools changed from restricted list to "*" to support team tools (same pattern as research.md)
- tasks.md allowed-tools changed from restricted list to "*" to support team tools (same pattern as other phases)
- All changes are markdown-only; no compilation or build step required
- Plugin version bump is mandatory per CLAUDE.md for any plugin file change
- research.md allowed-tools changed from restricted list to "*" to support team tools (TeamCreate, TaskCreate, TaskList, SendMessage, TeamDelete)
- POC checkpoint: all 5 files verified consistent team lifecycle, correct naming convention ($phase-$spec), orphaned cleanup present, markdown structure intact, non-team sections preserved
- Plugin structural validation: plugin.json valid JSON with name/version/description, hooks.json valid with both scripts existing and executable, all 14 command files have valid YAML frontmatter with description, all 8 agent files have valid frontmatter with name+description
- Standardized all 5 files to 8-step team lifecycle: Step 1 (Check for Orphaned Team), Step 2 (Create Team), Step 3 (Create Tasks), Step 4 (Spawn Teammates), Step 5 (Wait for Completion), Step 6 (Shutdown Teammates), Step 7 (Collect Results), Step 8 (Clean Up Team)
- research.md had "Identify Research Topics" renamed to "Pre-Step" since it happens before the team lifecycle
- Feedback loop re-invocation sections (in requirements.md, design.md, tasks.md) now use same 1-8 step numbering instead of A-F
- implement.md uses bold (**Step N:**) instead of h3 (### Step N:) because steps are nested inside Section 6 -- this is correct heading hierarchy
- Markdown structure integrity verified for all 5 command files: valid frontmatter YAML, matched mandatory tags, matched code fences, correct heading hierarchy, all original sections present. No fixes needed.

## Next
Task 4.1: Bump plugin version
