# Parallel Task Execution

## Goal

Add support for parallel task execution using [P] markers in tasks.md. Tasks marked with [P] that are consecutive will be grouped and executed simultaneously using multiple executors.

## Progress

- [x] Research phase
- [x] Requirements phase
- [x] Design phase
- [x] Tasks phase
- [ ] Execution phase

## Completed Tasks
- [x] 1.1 Add parallel state fields to schema

## Learnings

### Research Phase
- Task tool parallel pattern already proven in research.md (multiple research-analysts)
- Orchestrator-worker pattern recommended (implement.md as coordinator)
- No stop-handler changes needed
- [VERIFY] tasks must remain sequential (V4->V5->V6 order)
- .progress.md has race condition risk with concurrent writes
- State management needs parallel-aware fields

### Requirements Phase
- [P] marker syntax chosen for simplicity over block-based [PARALLEL]/[/PARALLEL] syntax
- Consecutive grouping avoids complex dependency graph parsing
- Isolated temp files (.progress-task-N.md) solve race condition cleanly
- BATCH_COMPLETE signal differentiates parallel vs sequential completion
- Failure handling "continue and retry" preserves successful work
- [VERIFY] and [SEQUENTIAL] tags override [P] for safety
- Git commit serialization after batch avoids merge conflicts
- State needs parallelGroup, taskResults fields for batch tracking

### Design Phase
- All parallel logic in implement.md coordinator, stop-handler untouched
- Coordinator outputs both TASK_COMPLETE and BATCH_COMPLETE to satisfy stop-handler regex
- State updates taskIndex to group endIndex+1 before outputting completion signal
- Executor accepts optional progressFile parameter for isolated writes
- Merge strategy: append learnings and completed tasks in task index order
- Max 3 concurrent executors default, configurable
- Single [P] task treated as sequential (no overhead for group size 1)
- [VERIFY] on same line as [P] causes [VERIFY] to win (override precedence)

### Tasks Phase
- Tasks 1.2 and 1.3 marked [P] to demonstrate parallel execution in spec itself
- Schema update (1.1) must complete before executor/coordinator changes can reference it
- POC test spec (1.10) validates end-to-end before refinement
- Test specs created in Phase 3 are temporary, removed in Phase 4.3
- Quality checkpoints after every 2-3 tasks as per workflow rules
- [VERIFY] tasks never marked [P] per requirements FR-003/FR-004

### Execution Phase
- 1.1: Schema extended with parallelGroup (startIndex, endIndex, taskIndices) and taskResults (status map with pending/success/failed)

## Current Task
Awaiting next task

## Next
Task 1.2 [P] Add progressFile parameter to spec-executor
